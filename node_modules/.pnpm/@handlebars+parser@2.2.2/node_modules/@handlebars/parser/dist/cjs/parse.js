"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseWithoutProcessing = parseWithoutProcessing;
exports.parse = parse;
var parser_js_1 = __importDefault(require("./parser.js"));
var whitespace_control_js_1 = __importDefault(require("./whitespace-control.js"));
var Helpers = __importStar(require("./helpers.js"));
var baseHelpers = {};
for (var helper in Helpers) {
    if (Object.prototype.hasOwnProperty.call(Helpers, helper)) {
        baseHelpers[helper] = Helpers[helper];
    }
}
function parseWithoutProcessing(input, options) {
    var _a, _b, _c;
    // Just return if an already-compiled AST was passed in.
    if (input.type === 'Program') {
        return input;
    }
    parser_js_1.default.yy = baseHelpers;
    // Altering the shared object here, but this is ok as parser is a sync operation
    parser_js_1.default.yy.locInfo = function (locInfo) {
        return new Helpers.SourceLocation(options && options.srcName, locInfo);
    };
    var squareSyntax;
    if (typeof ((_a = options === null || options === void 0 ? void 0 : options.syntax) === null || _a === void 0 ? void 0 : _a.square) === 'function') {
        squareSyntax = options.syntax.square;
    }
    else if (((_b = options === null || options === void 0 ? void 0 : options.syntax) === null || _b === void 0 ? void 0 : _b.square) === 'node') {
        squareSyntax = arrayLiteralNode;
    }
    else {
        squareSyntax = 'string';
    }
    var hashSyntax;
    if (typeof ((_c = options === null || options === void 0 ? void 0 : options.syntax) === null || _c === void 0 ? void 0 : _c.hash) === 'function') {
        hashSyntax = options.syntax.hash;
    }
    else {
        hashSyntax = hashLiteralNode;
    }
    parser_js_1.default.yy.syntax = {
        square: squareSyntax,
        hash: hashSyntax,
    };
    return parser_js_1.default.parse(input);
}
function arrayLiteralNode(array, loc) {
    return {
        type: 'ArrayLiteral',
        items: array,
        loc: loc,
    };
}
function hashLiteralNode(hash, loc) {
    return {
        type: 'HashLiteral',
        pairs: hash.pairs,
        loc: loc,
    };
}
function parse(input, options) {
    var ast = parseWithoutProcessing(input, options);
    var strip = new whitespace_control_js_1.default(options);
    return strip.accept(ast);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9saWIvcGFyc2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVlBLHdEQXFDQztBQWtCRCxzQkFLQztBQXhFRCwwREFBaUM7QUFDakMsa0ZBQXdEO0FBQ3hELG9EQUF3QztBQUV4QyxJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7QUFFckIsS0FBSyxJQUFJLE1BQU0sSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUMzQixJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUMxRCxXQUFXLENBQUMsTUFBTSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3hDLENBQUM7QUFDSCxDQUFDO0FBRUQsU0FBZ0Isc0JBQXNCLENBQUMsS0FBSyxFQUFFLE9BQU87O0lBQ25ELHdEQUF3RDtJQUN4RCxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssU0FBUyxFQUFFLENBQUM7UUFDN0IsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsbUJBQU0sQ0FBQyxFQUFFLEdBQUcsV0FBVyxDQUFDO0lBRXhCLGdGQUFnRjtJQUNoRixtQkFBTSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEdBQUcsVUFBVSxPQUFPO1FBQ25DLE9BQU8sSUFBSSxPQUFPLENBQUMsY0FBYyxDQUFDLE9BQU8sSUFBSSxPQUFPLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3pFLENBQUMsQ0FBQztJQUVGLElBQUksWUFBWSxDQUFDO0lBRWpCLElBQUksT0FBTyxDQUFBLE1BQUEsT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLE1BQU0sMENBQUUsTUFBTSxDQUFBLEtBQUssVUFBVSxFQUFFLENBQUM7UUFDbEQsWUFBWSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ3ZDLENBQUM7U0FBTSxJQUFJLENBQUEsTUFBQSxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUUsTUFBTSwwQ0FBRSxNQUFNLE1BQUssTUFBTSxFQUFFLENBQUM7UUFDOUMsWUFBWSxHQUFHLGdCQUFnQixDQUFDO0lBQ2xDLENBQUM7U0FBTSxDQUFDO1FBQ04sWUFBWSxHQUFHLFFBQVEsQ0FBQztJQUMxQixDQUFDO0lBRUQsSUFBSSxVQUFVLENBQUM7SUFFZixJQUFJLE9BQU8sQ0FBQSxNQUFBLE9BQU8sYUFBUCxPQUFPLHVCQUFQLE9BQU8sQ0FBRSxNQUFNLDBDQUFFLElBQUksQ0FBQSxLQUFLLFVBQVUsRUFBRSxDQUFDO1FBQ2hELFVBQVUsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNuQyxDQUFDO1NBQU0sQ0FBQztRQUNOLFVBQVUsR0FBRyxlQUFlLENBQUM7SUFDL0IsQ0FBQztJQUVELG1CQUFNLENBQUMsRUFBRSxDQUFDLE1BQU0sR0FBRztRQUNqQixNQUFNLEVBQUUsWUFBWTtRQUNwQixJQUFJLEVBQUUsVUFBVTtLQUNqQixDQUFDO0lBRUYsT0FBTyxtQkFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUM3QixDQUFDO0FBRUQsU0FBUyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsR0FBRztJQUNsQyxPQUFPO1FBQ0wsSUFBSSxFQUFFLGNBQWM7UUFDcEIsS0FBSyxFQUFFLEtBQUs7UUFDWixHQUFHLEtBQUE7S0FDSixDQUFDO0FBQ0osQ0FBQztBQUVELFNBQVMsZUFBZSxDQUFDLElBQUksRUFBRSxHQUFHO0lBQ2hDLE9BQU87UUFDTCxJQUFJLEVBQUUsYUFBYTtRQUNuQixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7UUFDakIsR0FBRyxLQUFBO0tBQ0osQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFnQixLQUFLLENBQUMsS0FBSyxFQUFFLE9BQU87SUFDbEMsSUFBSSxHQUFHLEdBQUcsc0JBQXNCLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2pELElBQUksS0FBSyxHQUFHLElBQUksK0JBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFM0MsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzNCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGFyc2VyIGZyb20gJy4vcGFyc2VyLmpzJztcbmltcG9ydCBXaGl0ZXNwYWNlQ29udHJvbCBmcm9tICcuL3doaXRlc3BhY2UtY29udHJvbC5qcyc7XG5pbXBvcnQgKiBhcyBIZWxwZXJzIGZyb20gJy4vaGVscGVycy5qcyc7XG5cbmxldCBiYXNlSGVscGVycyA9IHt9O1xuXG5mb3IgKGxldCBoZWxwZXIgaW4gSGVscGVycykge1xuICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKEhlbHBlcnMsIGhlbHBlcikpIHtcbiAgICBiYXNlSGVscGVyc1toZWxwZXJdID0gSGVscGVyc1toZWxwZXJdO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZVdpdGhvdXRQcm9jZXNzaW5nKGlucHV0LCBvcHRpb25zKSB7XG4gIC8vIEp1c3QgcmV0dXJuIGlmIGFuIGFscmVhZHktY29tcGlsZWQgQVNUIHdhcyBwYXNzZWQgaW4uXG4gIGlmIChpbnB1dC50eXBlID09PSAnUHJvZ3JhbScpIHtcbiAgICByZXR1cm4gaW5wdXQ7XG4gIH1cblxuICBwYXJzZXIueXkgPSBiYXNlSGVscGVycztcblxuICAvLyBBbHRlcmluZyB0aGUgc2hhcmVkIG9iamVjdCBoZXJlLCBidXQgdGhpcyBpcyBvayBhcyBwYXJzZXIgaXMgYSBzeW5jIG9wZXJhdGlvblxuICBwYXJzZXIueXkubG9jSW5mbyA9IGZ1bmN0aW9uIChsb2NJbmZvKSB7XG4gICAgcmV0dXJuIG5ldyBIZWxwZXJzLlNvdXJjZUxvY2F0aW9uKG9wdGlvbnMgJiYgb3B0aW9ucy5zcmNOYW1lLCBsb2NJbmZvKTtcbiAgfTtcblxuICBsZXQgc3F1YXJlU3ludGF4O1xuXG4gIGlmICh0eXBlb2Ygb3B0aW9ucz8uc3ludGF4Py5zcXVhcmUgPT09ICdmdW5jdGlvbicpIHtcbiAgICBzcXVhcmVTeW50YXggPSBvcHRpb25zLnN5bnRheC5zcXVhcmU7XG4gIH0gZWxzZSBpZiAob3B0aW9ucz8uc3ludGF4Py5zcXVhcmUgPT09ICdub2RlJykge1xuICAgIHNxdWFyZVN5bnRheCA9IGFycmF5TGl0ZXJhbE5vZGU7XG4gIH0gZWxzZSB7XG4gICAgc3F1YXJlU3ludGF4ID0gJ3N0cmluZyc7XG4gIH1cblxuICBsZXQgaGFzaFN5bnRheDtcblxuICBpZiAodHlwZW9mIG9wdGlvbnM/LnN5bnRheD8uaGFzaCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGhhc2hTeW50YXggPSBvcHRpb25zLnN5bnRheC5oYXNoO1xuICB9IGVsc2Uge1xuICAgIGhhc2hTeW50YXggPSBoYXNoTGl0ZXJhbE5vZGU7XG4gIH1cblxuICBwYXJzZXIueXkuc3ludGF4ID0ge1xuICAgIHNxdWFyZTogc3F1YXJlU3ludGF4LFxuICAgIGhhc2g6IGhhc2hTeW50YXgsXG4gIH07XG5cbiAgcmV0dXJuIHBhcnNlci5wYXJzZShpbnB1dCk7XG59XG5cbmZ1bmN0aW9uIGFycmF5TGl0ZXJhbE5vZGUoYXJyYXksIGxvYykge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdBcnJheUxpdGVyYWwnLFxuICAgIGl0ZW1zOiBhcnJheSxcbiAgICBsb2MsXG4gIH07XG59XG5cbmZ1bmN0aW9uIGhhc2hMaXRlcmFsTm9kZShoYXNoLCBsb2MpIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnSGFzaExpdGVyYWwnLFxuICAgIHBhaXJzOiBoYXNoLnBhaXJzLFxuICAgIGxvYyxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlKGlucHV0LCBvcHRpb25zKSB7XG4gIGxldCBhc3QgPSBwYXJzZVdpdGhvdXRQcm9jZXNzaW5nKGlucHV0LCBvcHRpb25zKTtcbiAgbGV0IHN0cmlwID0gbmV3IFdoaXRlc3BhY2VDb250cm9sKG9wdGlvbnMpO1xuXG4gIHJldHVybiBzdHJpcC5hY2NlcHQoYXN0KTtcbn1cbiJdfQ==